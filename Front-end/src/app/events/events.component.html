<ngx-one-column-layout>
    <nb-menu [items]="menu"></nb-menu>
    <router-outlet>
        <div class="container">
            <div class="row">

                <div class="col-4">
                    <div class="calendar-container">
                        <nb-calendar [(date)]="date" (click)="showEvent($event)" [boundingMonth]="true"
                            [dayCellComponent]="dayCellComponent" showWeekNumber></nb-calendar>
                    </div>
                </div>

                <div class="col-8">
                    <nb-card>
                        <nb-card-header>
                            Date : {{date | date : "dd/MM/yyyy"}}
                        </nb-card-header>

                        <nb-card-body *ngIf="!currentEvent.id">
                            <div class="default-background">Il n'y a pas d'évènement à cette date.</div>
                            <div style="text-align: center; margin-top: 10px;">
                                <button nbButton [status]="success" (click)="openPopup(dialog); popupType = 0;">
                                    Ajouter un évènement</button>
                            </div>
                        </nb-card-body>

                        <nb-card-body *ngIf="currentEvent.id">
                            <div class="col-6" style="display: inline-block;">
                                <strong>{{currentEvent.name}}</strong> <br />
                                <div>{{currentEvent.body}}</div>
                                <div>{{currentEvent.address}}</div>
                                <div>{{currentEvent.zipcode}} {{currentEvent.city}}</div>
                            </div>
                            <div class="col-6" style="display: inline-block;">
                                <div style="text-align: center;" *ngIf="imagePath">
                                    <img [src]="imagePath" style="max-width: 260px; max-height: 200px;" />
                                </div>
                            </div>

                            <div style="text-align: center; margin-top: 10px;">
                                <button nbButton [status]="success" (click)="openPopup(dialog); popupType = 1;" 
                                    style="margin-right: 10px;">Modifier</button>
                                <button nbButton [status]="danger" (click)="openPopup(dialog2);">
                                    Supprimer</button>
                            </div>
                        </nb-card-body>

                    </nb-card>
                </div>

            </div>
        </div>
    </router-outlet>
</ngx-one-column-layout>

<ng-template #dialog let-data let-ref="dialogRef" size="lg">
    <nb-card>
        <nb-card-header *ngIf="popupType === 0">Ajouter un évènement</nb-card-header>
        <nb-card-header *ngIf="popupType === 1">Modifier un évènement</nb-card-header>
        <nb-card-body style="max-width: 400px;">

            <div class="form-group">
                <label for="name" class="label">Nom</label>
                <input type="text" nbInput fullWidth id="name" [(ngModel)]="currentEvent.name" placeholder="Nom">
            </div>

            <div class="form-group">
                <label for="body" class="label">Contenu</label>
                <textarea nbInput fullWidth id="body" [(ngModel)]="currentEvent.body" placeholder="Contenu"></textarea>
            </div>

            <div class="form-group">
                <label for="address" class="label">Adresse</label>
                <input type="text" nbInput fullWidth id="address" [(ngModel)]="currentEvent.address"
                    placeholder="Adresse">
            </div>

            <div class="form-group">
                <div class="col-5" style="display: inline-block; padding-left: 0px;">
                    <label for="zipcode" class="label">Code postal</label>
                    <input type="number" nbInput fullWidth id="zipcode" [(ngModel)]="currentEvent.zipcode"
                        placeholder="Code postal">
                </div>

                <div class="col-7" style="display: inline-block; padding: 0px;">
                    <label for="city" class="label">Ville</label>
                    <input type="text" nbInput fullWidth id="city" [(ngModel)]="currentEvent.city" placeholder="Ville">
                </div>
            </div>

            <div style="position: relative;">
                <label for="image" class="label" style="display: block;">Image</label>
                <label nbButton for="image" *ngIf="!imageBase64 && !imagePath" class="input-file">
                    <i class="fas fa-plus"></i>
                </label>
                <input type="file" id="image" style="display: none;" (change)="fileChangeEvent($event)"
                    accept=".png, .jpeg, .jpg">

                <button nbButton [size]="medium" class="close-button" (click)="imageBase64 = null; imagePath = null;"
                    *ngIf="imageBase64 || imagePath">
                    <i class="fas fa-times" style="margin-top: 2px;"></i>
                </button>

                <div style="text-align: center;" *ngIf="imageBase64 && popupType === 0">
                    <img [src]="imageBase64" style="max-width: 200px; max-height: 160px;" />
                </div>
                <div style="text-align: center;" *ngIf="imagePath && !imageBase64 && popupType === 1">
                    <img [src]="imagePath" style="max-width: 200px; max-height: 160px;" />
                </div>
            </div>

        </nb-card-body>
        <nb-card-footer style="text-align: center;">
            <button nbButton [status]="danger" (click)="ref.close()" style="margin-right: 10px;">Annuler</button>

            <button nbButton [status]="success" (click)="ref.close(); addEvent();"
                *ngIf="popupType === 0">Ajouter</button>
            <button nbButton [status]="success" (click)="ref.close(); updateEvent();"
                *ngIf="popupType === 1">Sauvegarder</button>

        </nb-card-footer>
    </nb-card>
</ng-template>

<ng-template #dialog2 let-data let-ref="dialogRef">
    <nb-card>
        <nb-card-header>Confirmation de suppression</nb-card-header>
        <nb-card-body style="max-width: 400px;">

            <div style="line-height: 1.5;">
                Si vous confirmez, l'évènement {{currentEvent.name}} sera définitivement supprimé.
            </div>

        </nb-card-body>
        <nb-card-footer style="text-align: center;">
            <button nbButton [status]="danger" (click)="ref.close()" style="margin-right: 10px;">Annuler</button>
            <button nbButton [status]="success" (click)="deleteEvent(); ref.close()">Confirmer</button>
        </nb-card-footer>
    </nb-card>
</ng-template>